# Руководство по устранению неполадок

В этом руководстве описаны основные проблемы, которые могут возникнуть при работе с приложением "Займы онлайн", и способы их решения.

## Содержание

1. [Проблемы с запуском приложения](#проблемы-с-запуском-приложения)
2. [Проблемы с push-уведомлениями](#проблемы-с-push-уведомлениями)
3. [Проблемы со сборкой APK](#проблемы-со-сборкой-apk)
4. [Проблемы с интерфейсом](#проблемы-с-интерфейсом)
5. [Конфликты портов](#конфликты-портов)

## Проблемы с запуском приложения

### Ошибка "EADDRINUSE: address already in use"

**Проблема**: При запуске приложения возникает ошибка "EADDRINUSE: address already in use".

**Решение**:
1. Выполните команду для поиска процесса, занимающего порт 5000:
   ```bash
   lsof -i :5000
   ```

2. Завершите найденный процесс:
   ```bash
   kill -9 <PID>
   ```

3. Запустите приложение снова:
   ```bash
   npm run dev
   ```

### Ошибка "Module not found"

**Проблема**: При запуске приложения возникает ошибка "Cannot find module..."

**Решение**:
1. Установите зависимости заново:
   ```bash
   npm install
   ```

2. Очистите кэш npm:
   ```bash
   npm cache clean --force
   ```

3. Запустите приложение:
   ```bash
   npm run dev
   ```

## Проблемы с push-уведомлениями

### Не отправляются уведомления

**Проблема**: Уведомления не отправляются или не приходят.

**Решение**:
1. Проверьте наличие переменных окружения:
   ```bash
   echo $VITE_ONESIGNAL_APP_ID
   echo $VITE_ONESIGNAL_REST_API_KEY
   ```

2. Проверьте статус OneSignal:
   - Зайдите на https://app.onesignal.com/
   - Проверьте, что ваше приложение активно

3. Проверьте консоль на наличие ошибок при отправке уведомлений.

### Ошибка "API Key is invalid"

**Проблема**: При отправке уведомлений появляется ошибка "API Key is invalid".

**Решение**:
1. Проверьте значение ключа API в административной панели:
   - Войдите в OneSignal Dashboard
   - Перейдите в Settings > Keys & IDs
   - Скопируйте REST API Key

2. Обновите переменную окружения:
   ```bash
   export VITE_ONESIGNAL_REST_API_KEY="ваш_новый_ключ"
   ```

3. Перезапустите приложение.

## Проблемы со сборкой APK

### Ошибка "Capacitor not installed"

**Проблема**: При сборке APK возникает ошибка, связанная с Capacitor.

**Решение**:
1. Установите Capacitor глобально:
   ```bash
   npm install -g @capacitor/cli
   ```

2. Установите необходимые пакеты:
   ```bash
   npm install @capacitor/core @capacitor/android
   ```

3. Запустите скрипт подготовки заново:
   ```bash
   node prepare-for-apk.js
   ```

### Ошибка "Google Services plugin not applied"

**Проблема**: При сборке APK в Android Studio возникает ошибка Google Services.

**Решение**:
1. Убедитесь, что файл `google-services.json` находится в правильной директории:
   ```bash
   ls -la android/app/
   ```

2. Если файла нет, используйте шаблон:
   ```bash
   cp client/google-services.json.template android/app/google-services.json
   ```

3. Для работы с реальными push-уведомлениями замените этот файл на реальный, полученный из Firebase Console.

### Ошибка "SDK Location not found"

**Проблема**: Android Studio не может найти SDK.

**Решение**:
1. Создайте файл `local.properties` в директории android:
   ```bash
   echo "sdk.dir=/путь/к/android/sdk" > android/local.properties
   ```

2. Или укажите путь в Android Studio:
   - File > Project Structure > SDK Location

## Проблемы с интерфейсом

### Не загружаются логотипы МФО

**Проблема**: Логотипы МФО не отображаются в списке займов.

**Решение**:
1. Проверьте, что файлы логотипов существуют:
   ```bash
   ls -la public/logos/
   ```

2. Убедитесь, что пути к логотипам указаны правильно в данных:
   ```bash
   curl http://localhost:5000/api/loans
   ```

3. Проверьте консоль браузера на наличие ошибок загрузки.

### Проблемы со стилями

**Проблема**: Стили не применяются или отображаются некорректно.

**Решение**:
1. Обновите зависимости:
   ```bash
   npm install tailwindcss@latest postcss@latest autoprefixer@latest
   ```

2. Пересоберите стили:
   ```bash
   npx tailwindcss build -i client/src/index.css -o public/styles.css
   ```

3. Перезапустите приложение.

## Конфликты портов

### Основное приложение и push-сервер конфликтуют

**Проблема**: Push-сервер и основное приложение конфликтуют из-за одинакового порта.

**Решение**:
1. Измените порт push-сервера в файле `run-push-server.js`:
   ```javascript
   const PORT = 3000; // Измените на другой, например, 3001
   ```

2. Перезапустите оба сервера:
   ```bash
   ./build-and-run-app.sh
   ```

### Другие сервисы используют порты приложения

**Проблема**: Другие сервисы используют порты 5000 или 3000.

**Решение**:
1. Измените порт основного приложения в `server/index.ts`:
   ```typescript
   const PORT = process.env.PORT || 5001; // Измените порт
   ```

2. Измените порт push-сервера в `run-push-server.js`:
   ```javascript
   const PORT = 3001; // Используйте другой порт
   ```

3. Обновите URL в клиентской части, если необходимо.

## Дополнительная информация

Если возникают другие проблемы, не описанные в этом руководстве, пожалуйста, создайте обращение с подробным описанием проблемы и шагами для ее воспроизведения.