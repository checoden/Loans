#!/bin/bash
# Скрипт для запуска сервера push-уведомлений с автоматическим перезапуском

# Функция для запуска сервера
function startServer() {
  echo "Запуск push-сервера на порту 3000..."
  
  # Убиваем все предыдущие экземпляры сервера
  pkill -f "node push-server.js" || true
  
  # Запускаем сервер push-уведомлений в фоновом режиме
  NODE_ENV=production PORT=3000 node push-server.js > push-server.log 2>&1 &
  
  echo "Push-сервер запущен. PID: $!"
  echo "Логи записываются в файл push-server.log"
  
  # Отображаем сообщение об успешном запуске
  echo ""
  echo "=============================================================="
  echo "  Push-сервер успешно запущен на порту 3000"
  echo "  Откройте http://localhost:3000 в браузере"
  echo ""
  echo "  Для просмотра логов используйте команду:"
  echo "  tail -f push-server.log"
  echo "=============================================================="
}

# Запускаем сервер
startServer

# Ждем завершения работы скрипта
wait